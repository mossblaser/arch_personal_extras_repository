pkgname="prometheus_solcast_exporter"
pkgdesc="Quick and dirty unofficial Prometheus exporter for Solcast's free home solar forecast API"
url="https://github.com/mossblaser/prometheus_solcast_exporter"
pkgver="0.0.1"
pkgrel="3"
arch=('any')
license=('GPL3')

depends=('python-isodate' 'python-requests' 'python-prometheus_client' 'python>=3.13.0' 'python<3.14.0')
makedepends=('python-setuptools' 'python-build')

source=("https://pypi.io/packages/source/${pkgname::1}/$pkgname/$pkgname-$pkgver.tar.gz"
        "${pkgname}.service")
sha256sums=('e60b63a10b2c477c1dca9e89e1d449492dd2e8335c2375c585c4e772a08b32f1'
            'ecc3fc497197bdec61616c68826f4fe696147fc4a0ccaa584ed01cf556543a30')

build() {
  cd "$pkgname-$pkgver"
  python -m build --wheel
}

package() {
  cd "$pkgname-$pkgver"
  PIP_CONFIG_FILE=/dev/null pip install "dist/$pkgname-$pkgver-py3-none-any.whl" --isolated --root="$pkgdir" --ignore-installed --no-deps
  install -Dm644 "$srcdir/${pkgname}.service" "$pkgdir/usr/lib/systemd/system/${pkgname}.service"
}
